# Проектная работа "Веб-ларек"
![main-screen.png](images/main-screen.png)

## Стек: TypeScript, Webpack

## Структура проекта:
* src/ — исходные файлы проекта
* src/components/ — папка с JS компонентами
* src/components/base/ — папка с базовым кодом

Важные файлы:
* src/pages/index.html — HTML-файл главной страницы
* src/types/index.ts — файл с типами
* src/index.ts — точка входа приложения
* src/scss/styles.scss — корневой файл стилей
* src/utils/constants.ts — файл с константами
* src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды
```bash
yarn
yarn start
```
## Сборка
```bash
yarn build
```

## Архитектура проекта
Архитектура проекта на основе паттерна MVP (Model-View-Presenter) состоит из трех основных частей:

* Model (Модель) - отвечает за хранение данных и бизнес-логику приложения. Модель представляет собой набор классов, которые описывают сущности приложения (например, товары, корзина, заказы и т.д.) и предоставляют методы для работы с ними. Модель не зависит от представления и может быть использована в других частях приложения.
* View (Представление) - отвечает за отображение пользовательского интерфейса и взаимодействие с пользователем. Представление представляет собой набор классов, которые описывают элементы интерфейса (например, окна, формы, кнопки и т.д.) и предоставляют методы для их отображения и обработки событий от пользователя. Представление не содержит логики приложения и не должно обращаться напрямую к модели.
* Presenter (Презентер) - содержит бизнес-логику приложения и связывает модель и представление. Презентер представляет собой набор классов, которые обрабатывают события от представления, извлекают данные из модели, обрабатывают их и передают в представление для отображения. Презентер является посредником между моделью и представлением и обеспечивает их взаимодействие.
* Event Broker (Брокер событий) - обеспечивает обмен сообщениями между компонентами приложения. Брокер событий представляет собой набор классов, которые позволяют компонентам подписываться на события и отправлять сообщения другим компонентам. Брокер событий позволяет избежать жесткой связи между компонентами и упрощает взаимодействие между ними.

Принцип работы MVP с брокером событий следующий:

* Пользователь взаимодействует с представлением (нажимает кнопки, вводит данные и т.д.).
* Представление генерирует события и отправляет их в брокер событий.
* Брокер событий передает события в презентер, который подписан на эти события.
* Презентер обрабатывает события, вызывает методы модели для изменения данных и подписывается на события об изменении данных.
* Модель изменяет данные и генерирует события об изменении данных.
* Брокер событий передает события об изменении данных в презентер.
* Презентер обрабатывает события об изменении данных и вызывает методы представления для обновления отображения данных.
* Представление отображает данные и ждет новых событий от пользователя.

Таким образом, паттерн MVP с брокером событий позволяет разделить логику приложения и представление, а также обеспечить гибкое и удобное взаимодействие между компонентами приложения.

## Базовые классы

### 1. Класс Component
Класс Component - это базовый класс для всех представлений в приложении. Он предоставляет базовый функционал для работы с DOM-элементами и обработки событий.

Конструктор класса Component принимает следующие параметры:

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещено представление

Содержит следующие методы:
* render - отвечает за отображение представления
* remove - удаляет представление из DOM
* show - отображает представление
* hide - скрывает представление


### 2. Класс EventEmitter
Класс EventEmitter отвечает за обмен событиями между компонентами.

Содержит следующие поля:
* _events - хранилище событий приложения

Содержит следующие методы:
* on: Устанавливает обработчик на событие.
* off: Снимает обработчик с события.
* emit: Инициирует событие с данными.
* onAll: Подписывается на все события.
* offAll: Сбрасывает все обработчики.
* trigger: Возвращает функцию-триггер, генерирующую событие при вызове.

События, которые будет обрабатывать класс EventEmitter:

* catalog:changed - генерируется при изменении каталога приложения. Содержит массив объектов с информацией о карточках
* card:select - генерируется при открытии модалки карточки
* card:changed - генерируется при добавлении товара в корзину
* basket:open - генерируется при открытии корзины
* basket:changed - генерируется при редактировании корзины
* order:open - генерируется при переходе на форму заказа
* order:submit - генерируется при переходе на форму контактов
* contacts:submit - генерируется при отправке заказа
* modal:open - генерируется при открытии модалки
* modal:close - генерируется при закрытии модалки

### 3. Класс Api
Класс Api базовый класс для работы с API

Конструктор принимает следующие параметры:
* baseUrl - базовый URL API (тип: string)
* options - параметры запроса (тип: RequestInit)

Содержит следующие методы:
* handleResponse: Обработчик ответа от сервера
* get: Метод для выполнения GET-запроса
* post: Метод для выполнения POST-запроса


## Классы представления

### 4. Класс Page
Класс Page наследуется от класса Component и отвечает за отображение страницы. 

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещена страница
* events - хранилище событий

Содержит следующие поля:
* _counter - количество продуктов в корзине (тип: HTMLElement)
* _catalog - каталог продуктов (тип: HTMLElement)
* _preview - выбранный продукт (тип: HTMLElement)
* _basket - корзина (тип: HTMLElement)

Содержит следующие сеттеры:
* setCatalog - отвечает за отображение каталога
* lockPage - отвечает за блокировку страницы
* setBasketCounter - отвечает за отображение количества продуктов в корзине


### 5. Класс Card
Класс Card наследуется от класса Component и отвечает за отображение карточки товара.

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещена карточка
* events - хранилище событий

Содержит следующие поля:
* _title - содержит заголовок карточки (тип: HTMLElement)
* _description - содержит описание карточки (тип: HTMLElement)
* _category - содержит категорию карточки (тип: HTMLElement)
* _image - содержит изображение карточки (тип: HTMLElement)
* _price - содержит цену карточки (тип: HTMLElement)
* _button - содержит кнопку карточки (тип: HTMLElement)

Содержит следующие сеттеры:
* id - отвечает за отображение id карточки
* title - отвечает за отображение заголовка карточки
* description - отвечает за отображение описания карточки
* category - отвечает за отображение категории карточки
* image - отвечает за отображение изображения карточки
* price - отвечает за отображение цены карточки
* button - отвечает за отображение кнопки карточки


### 6. Класс Modal
Класс Modal наследуется от класса Component и отвечает за отображение модального окна.

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещено модальное окно
* events - хранилище событий

Содержит следующие поля:
* _content - содержит модальное окно (тип: HTMLElement)
* _closeButton - содержит кнопку закрытия модального окна (тип: HTMLButtonElement)

Содержит следующие методы:
* open - открывает модальное окно
* close - закрывает модальное окно
* render - отвечает за отображение модального окна


### 7. Класс Basket
Класс Basket наследуется от класса Component и отвечает за отображение корзины.

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещены элементы корзины
* events - хранилище событий

Содержит следующие поля:
* items - содержит элементы корзины (тип: HTMLElement[])
* total - содержит общую стоимость (тип: number)

Содержит следующие сеттеры:
* items - отвечает за отображение карточек в корзине
* total - отвечает за отображение общей стоимости

Содержит следующие методы:
* submitButtonLock - отвечает за блокировку кнопки оформления заказа


### 8. Класс Form
Класс Form наследуется от класса Component и отвечает за отображение формы.

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещена форма
* events - хранилище событий

Содержит следующие сеттеры:
* valid - отключает кнопку сабмита
* errors - отображает ошибки

Содержит следующие методы:
* onInputChange - отвечает за обработку изменений ввода
* render - отвечает за отображение формы


### 9. Класс OrderForm
Класс OrderForm наследуется от класса Form и отвечает за отображение формы оформления заказа.

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещена форма
* events - хранилище событий

Содержит следующие поля:
* _payment - тип оплаты (тип: String)
* _address - содержимое поля адрес (тип: String)

Содержит следующие сеттеры:
* payment - отвечает за выбор способа оплаты


### 10. Класс ContactsForm
Класс ContactsForm наследуется от класса Form и отвечает за отображение контактной информации.

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещена форма
* events - хранилище событий

Содержит следующие поля:
* _phone - содержимое поля телефон (тип: String)
* _email - содержимое поля email (тип: String)


### 11. Класс Success
Класс Success наследуется от класса Component и отвечает за отображение сообщения об успешном выполнении операции.:

Конструктор принимает следующие параметры:
* container - ссылка на DOM-элемент, в котором будет размещена форма
* events - хранилище событий

Содержит следующие сеттеры:
* total - отвечает за отображение общей итоговой стоимости заказа

## Классы моделей

### 12. Класс AppState
Класс AppState наследуется от класса Model и отвечает за работу с данными приложения.

Содержит следующие поля:
* catalog - содержит список продуктов (тип: Array IProduct)
* preview - содержит текущий выбранный продукт (тип: Object IProduct)
* basket - содержит список добавленных в корзину продуктов (тип: Object IBasket)
* order - содержит информацию о заказе (тип: Object IOrder)

Содержит следующие методы:
* setCatalog - устанавливает список продуктов 
* setPreview - устанавливает текущий выбранный продукт
* isInBasket - проверяет наличие продукта в корзине. Возвращает true или false
* addToBasket - добавляет продукт в корзину
* removeFromBasket - удаляет продукт из корзины
* setOrderField - устанавливает значение в поле для заказа
* setPayment - устанавливает способ оплаты
* validateOrderForm - валидирует форму для оформления заказа. Возвращает true или false
* validateContactsForm - валидирует форму для контактной информации. Возвращает true или false
* clearBasket - очищает корзину


## Вспомогательные классы

### 13. Класс LarekApi
Класс LarekApi наследуется от класса Api и добавляет специфические методы для работы магазина.

Содержит следующие поля:
* cdn - ссылка на CDN
* baseUrl - базовый URL-адрес

Содержит следующие методы:
* getProducts - получение списка товаров с сервера
* getProduct - Отправка заказа
* sendOrder - отправка заказа на сервер


## Базовые типы
'''typescript
interface IProduct {
id: string;
description: string;
image: string;
title: string;
category: string;
price: number;
}

interface IBasket {
items: string[];
total: number;
}

interface IPayments {
payment: PaymentMethod;
address: string;
}

interface IContacts {
email: string;
phone: string;
}

interface IOrder extends IPayments, IContacts {}

interface IAppState {
catalog: IProduct[];
cart: IBasket;
order: IOrder;
selectedItem?: string;
isLoading: boolean;
isError: boolean;
}

type PaymentMethod = 'cash' | 'card';

type FormErrors = Partial<Record<keyof IOrder, string>>;

interface ILarekApi {
getProducts(): Promise<Product[]  | ResponseError>;
sendOrder(order: Order): Promise<OrderResult | ResponseError>;
}

'''