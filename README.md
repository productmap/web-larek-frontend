# Проектная работа "Веб-ларек"
![main-screen.png](images/main-screen.png)

## Стек: TypeScript, Webpack

## Структура проекта:
* src/ — исходные файлы проекта
* src/components/ — папка с JS компонентами
* src/components/base/ — папка с базовым кодом

Важные файлы:
* src/pages/index.html — HTML-файл главной страницы
* src/types/index.ts — файл с типами
* src/index.ts — точка входа приложения
* src/scss/styles.scss — корневой файл стилей
* src/utils/constants.ts — файл с константами
* src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды
```bash
yarn
yarn start
```
## Сборка
```bash
yarn build
```

## Архитектура проекта
Архитектура проекта на основе паттерна MVP (Model-View-Presenter) состоит из трех основных частей:

* Model (Модель) - отвечает за хранение данных и бизнес-логику приложения. Модель представляет собой набор классов, которые описывают сущности приложения (например, товары, корзина, заказы и т.д.) и предоставляют методы для работы с ними. Модель не зависит от представления и может быть использована в других частях приложения.
* View (Представление) - отвечает за отображение пользовательского интерфейса и взаимодействие с пользователем. Представление представляет собой набор классов, которые описывают элементы интерфейса (например, окна, формы, кнопки и т.д.) и предоставляют методы для их отображения и обработки событий от пользователя. Представление не содержит логики приложения и не должно обращаться напрямую к модели.
* Presenter (Презентер) - содержит бизнес-логику приложения и связывает модель и представление. Презентер представляет собой набор классов, которые обрабатывают события от представления, извлекают данные из модели, обрабатывают их и передают в представление для отображения. Презентер является посредником между моделью и представлением и обеспечивает их взаимодействие.
* Event Broker (Брокер событий) - обеспечивает обмен сообщениями между компонентами приложения. Брокер событий представляет собой набор классов, которые позволяют компонентам подписываться на события и отправлять сообщения другим компонентам. Брокер событий позволяет избежать жесткой связи между компонентами и упрощает взаимодействие между ними.

Принцип работы MVP с брокером событий следующий:

* Пользователь взаимодействует с представлением (нажимает кнопки, вводит данные и т.д.).
* Представление генерирует события и отправляет их в брокер событий.
* Брокер событий передает события в презентер, который подписан на эти события.
* Презентер обрабатывает события, вызывает методы модели для изменения данных и подписывается на события об изменении данных.
* Модель изменяет данные и генерирует события об изменении данных.
* Брокер событий передает события об изменении данных в презентер.
* Презентер обрабатывает события об изменении данных и вызывает методы представления для обновления отображения данных.
* Представление отображает данные и ждет новых событий от пользователя.

Таким образом, паттерн MVP с брокером событий позволяет разделить логику приложения и представление, а также обеспечить гибкое и удобное взаимодействие между компонентами приложения.

## Базовые классы

### 1. Класс Component
Класс Component - это базовый класс для всех представлений в приложении. Он предоставляет базовый функционал для работы с DOM-элементами и обработки событий.

Конструктор класса Component принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещено представление

Содержит следующие методы:
* render - отвечает за отображение представления
* remove - удаляет представление из DOM
* show - отображает представление
* hide - скрывает представление


### 2. Класс EventEmitter
Класс EventEmitter отвечает за обмен событиями между компонентами. Конструктор класса EventEmitter не принимает параметров.

Содержит следующие свойства:
* _events - хранилище событий

Содержит следующие методы:
* on: Устанавливает обработчик на событие.
* off: Снимает обработчик с события.
* emit: Инициирует событие с данными.
* onAll: Подписывается на все события.
* offAll: Сбрасывает все обработчики.
* trigger: Возвращает функцию-триггер, генерирующую событие при вызове.

События, которые будет обрабатывать класс EventEmitter:

* catalog:changed - генерируется при изменении каталога приложения. Содержит массив объектов с информацией о карточках
* card:select - генерируется при открытии модалки карточки
* card:changed - генерируется при добавлении товара в корзину
* basket:open - генерируется при открытии корзины
* basket:changed - генерируется при редактировании корзины
* order:open - генерируется при переходе на форму заказа
* order:submit - генерируется при переходе на форму контактов
* contacts:submit - генерируется при отправке заказа
* modal:open - генерируется при открытии модалки
* modal:close - генерируется при закрытии модалки

### 3. Класс Api
Класс Api базовый класс для работы с API

Содержит следующие свойства:
* baseUrl - базовый URL API
* options - параметры запроса

Содержит следующие методы:
* handleResponse: Обработчик ответа от сервера
* get: Метод для выполнения GET-запроса
* post: Метод для выполнения POST-запроса


## Классы представления

### 4. Класс Page
Класс Page наследуется от класса Component и отвечает за отображение страницы. Конструктор класса Page принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещена страница
* events - хранилище событий

Содержит следующие методы:
* catalog - отвечает за отображение каталога
* locked - отвечает за блокировку каталога
* basketCounter - отвечает за отображение количества продуктов в корзине


### 5. Класс Card
Класс Card наследуется от класса Component и отвечает за отображение карточки товара. Конструктор класса Card принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещена карточка
* events - хранилище событий

Содержит следующие методы:
* title - отвечает за отображение заголовка карточки
* price - отвечает за отображение цены карточки
* button - отвечает за отображение кнопки карточки
* image - отвечает за отображение изображения карточки
* description - отвечает за отображение описания карточки


### 6. Класс Modal
Класс Modal наследуется от класса Component и отвечает за отображение модального окна. Конструктор класса Modal принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещено модальное окно
* events - хранилище событий

Содержит следующие методы:
* open - открывает модальное окно
* close - закрывает модальное окно
* render - отвечает за отображение модального окна


### 7. Класс Basket
Класс Basket наследуется от класса Component и отвечает за отображение корзины. Конструктор класса Basket принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещены элементы корзины
* events - хранилище событий

Содержит следующие методы:
* items - отвечает за отображение карточек в корзине
* total - отвечает за отображение общей стоимости
* submitButtonLock - отвечает за блокировку кнопки оформления заказа


### 8. Класс Form
Класс Form наследуется от класса Component и отвечает за отображение формы. Конструктор класса Form принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещена форма
* events - хранилище событий

Содержит следующие методы:
* render - отвечает за отображение формы


### 9. Класс OrderForm
Класс Order наследуется от класса Component и отвечает за отображение формы оформления заказа. Конструктор класса Order принимает следующие параметры:

* payments - содержимое поля email (тип: String)
* address - содержимое поля email (тип: String)

Содержит следующие методы:
* payment - отвечает за отображение способа оплаты


### 10. Класс ContactsForm
Класс Contacts наследуется от класса Component и отвечает за отображение контактной информации. Конструктор класса Contacts принимает следующие параметры:

* phone - содержимое поля email (тип: String)
* email - содержимое поля email (тип: String)


### 11. Класс Success
Класс Success наследуется от класса Component и отвечает за отображение сообщения об успешном выполнении операции. Конструктор класса Success принимает следующие параметры:

Содержит следующие свойства:
* container - ссылка на DOM-элемент, в котором будет размещена форма
* events - хранилище событий

Содержит следующие методы:
* total - отвечает за отображение общей итоговой стоимости заказа

## Классы моделей

### 12. Класс AppData
Класс AppData отвечает за работу с данными приложения. Конструктор класса AppData принимает следующие параметры:

Содержит следующие свойства:
* catalog - содержит список продуктов
* preview - содержит текущий выбранный продукт
* basket - содержит список добавленных в корзину продуктов
* order - содержит информацию о заказе

Содержит следующие методы:
* setCatalog - устанавливает список продуктов
* setPreview - устанавливает текущий выбранный продукт
* isInBasket - проверяет наличие продукта в корзине
* addToBasket - добавляет продукт в корзину
* removeFromBasket - удаляет продукт из корзины
* setOrderField - устанавливает значение в поле для заказа
* setPayment - устанавливает способ оплаты
* validateOrderForm - валидирует форму для оформления заказа
* validateContactsForm - валидирует форму для контактной информации
* sendOrder - отправляет заказ на сервер
* clearBasket - очищает корзину


## Вспомогательные классы

### 13. Класс LarekApi
Класс LarekApi наследуется от класса Api и добавляет специфические методы для работы магазина

Содержит следующие свойства:
* cdn - ссылка на CDN
* baseUrl - базовый URL-адрес

Содержит следующие методы:
* getProducts - получение списка товаров с сервера
* getProduct - Отправка заказа
* sendOrder - отправка заказа на сервер


## Базовые типы
'''typescript
interface IProduct {
id: string;
description: string;
image: string;
title: string;
category: string;
price: number;
}

interface IBasket {
items: string[];
total: number;
}

interface IPayments {
payment: PaymentMethod;
address: string;
}

interface IContacts {
email: string;
phone: string;
}

interface IOrder extends IPayments, IContacts {}

interface IAppState {
catalog: IProduct[];
cart: IBasket;
order: IOrder;
selectedItem?: string;
isLoading: boolean;
isError: boolean;
}

type PaymentMethod = 'cash' | 'card';

type FormErrors = Partial<Record<keyof IOrder, string>>;

interface ILarekApi {
getProducts(): Promise<Product[]  | ResponseError>;
sendOrder(order: Order): Promise<OrderResult | ResponseError>;
}

'''